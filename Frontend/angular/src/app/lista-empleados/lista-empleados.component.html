<div class="row">

  <div class="col-2">
    <label for="filtroNombre" class="form-label">Nombre</label>
    <input id="filtroNombre" type="text" class="form-control" [(ngModel)]="filtroNombre" (ngModelChange)="filtrar()">
  </div>

  <div class="col-3">
    <label for="filtroEmail" class="form-label">Email</label>
    <input id="filtroEmail" type="text" class="form-control" [(ngModel)]="filtroEmail" (ngModelChange)="filtrar()">
  </div>

  <div class="col-2">
    <label class="form-label">Rol</label>
    <select class="form-select" [(ngModel)]="filtroRol" (change)="filtrar()">
      <option value=""></option>
      <option value="admin">Admin</option>
      <option value="operador">Operador</option>
      <option value="cliente">Cliente</option>
    </select>
  </div>

  <div class="col-2">
    <label class="form-label">Estado</label>
    <select class="form-select" [(ngModel)]="filtroEstado" (change)="filtrar()">
      <option value=""></option>
      <option value="true">Activo</option>
      <option value="false">Inactivo</option>
    </select>
  </div>

  <div id="botonLimpiar" class="col-1" title="Limpiar filtros"  data-bs-toggle="tooltip" 
  data-bs-placement="bottom" data-bs-title="Limpiar filtros">
    <button class="btn btn-secondary" (click)="limpiarFiltros()">
        <i class="bi bi-trash"></i>
    </button>
  </div>

  <div class="col"></div>
  <div id="crear" class="col-1">
      <button
        *ngIf="authRoles.esAdmin()"
        class="btn btn-success"
        data-bs-toggle="tooltip" 
        data-bs-placement="bottom"
        title="Crear empleado" 
        (click)="irPostEmpleado()">
        <i class="bi bi-plus-square"></i>
      </button>
  </div>

</div>

<!-- Tabla de empleados -->
<div class="tabla mt-3">
  <table class="table table-bordered table-striped table-hover align-middle">
    <thead class="table-dark text-center">
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let u of usuariosFiltrados">
        <td class="fw-semibold">{{ u.nombre }} {{ u.apellido }}</td>
        <td>{{ u.email }}</td>
        <td  class="text-center">
          <span
            class="badge"
            [ngClass]="{
              'bg-primary': u.rol === 'admin',
              'bg-warning text-dark': u.rol === 'operador',
              'bg-secondary': u.rol === 'cliente'
            }">
            {{ u.rol | titlecase }}
          </span>
        </td>

        <td class="text-center">
          <span
            class="badge"
            [ngClass]="{
              'bg-success': u.estado,
              'bg-danger': !u.estado
            }">
            {{ u.estado ? 'Activo' : 'Inactivo' }}
          </span>
        </td>

        <td class="text-center">
          <div class="dropdown">
            <button
              class="btn btn-sm btn-outline-dark dropdown-toggle"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end">

              <!-- Admin y operador pueden editar -->
              <li *ngIf="authRoles.esAdmin() || authRoles.esOperador()">
                <button
                  class="dropdown-item"
                  (click)="editarUsuario(u.usuario_id)">
                    Editar
                </button>
              </li>

              <!-- Solo admin puede eliminar -->
              <li *ngIf="authRoles.esAdmin()">
                <button
                  class="dropdown-item"
                  (click)="eliminarUsuario(u.usuario_id)">
                    Eliminar
                </button>
              </li>

            </ul>
          </div>
        </td>
      </tr>

      <!-- Si no hay usuarios -->
      <tr *ngIf="usuarios.length === 0">
        <td colspan="5" class="text-center text-muted py-3">
          No hay empleados registrados
        </td>
      </tr>
    </tbody>
  </table>
</div>
